# Observability Quick Start

## å¿«é€Ÿå¼€å§‹å¯è§‚æµ‹æ€§

### 1. å¯åŠ¨å®Œæ•´çš„å¯è§‚æµ‹æ€§æ ˆ

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ (Apify + Jaeger + Prometheus + Grafana)
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps
```

### 2. è®¿é—® UI

| æœåŠ¡ | URL | ç”¨é€” |
|------|-----|------|
| Apify API | http://localhost:3000 | ä¸»åº”ç”¨ç¨‹åº |
| Metrics | http://localhost:9090/metrics | PrometheusæŒ‡æ ‡ç«¯ç‚¹ |
| Jaeger | http://localhost:16686 | åˆ†å¸ƒå¼è¿½è¸ªUI |
| Prometheus | http://localhost:9092 | æŒ‡æ ‡æŸ¥è¯¢UI |
| Grafana | http://localhost:3002 | ä»ªè¡¨æ¿ (admin/admin) |

### 3. é…ç½®æ–‡ä»¶ç¤ºä¾‹

åˆ›å»º `config.yaml`:

```yaml
listeners:
  - port: 3000
    ip: "0.0.0.0"
    protocol: "http"
    apis:
      - path: "openapi/items.yaml"

# å¯è§‚æµ‹æ€§é…ç½®
observability:
  log_level: "info"                    # trace|debug|info|warn|error
  otlp_endpoint: "http://jaeger:4317"  # OpenTelemetry collector
  metrics_enabled: true                 # å¯ç”¨ Prometheus æŒ‡æ ‡
  metrics_port: 9090                    # æŒ‡æ ‡HTTPç«¯å£
```

### 4. æŸ¥çœ‹æ—¥å¿—

ç»“æ„åŒ– JSON æ—¥å¿—ç¤ºä¾‹:

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker compose logs -f apify-sqlite

# ç¤ºä¾‹æ—¥å¿—è¾“å‡º
{
  "timestamp": "2025-11-15T10:30:45Z",
  "level": "INFO",
  "fields": {
    "message": "Configuration loaded successfully",
    "config_file": "config.yaml"
  },
  "target": "apify::main"
}
```

### 5. æŸ¥çœ‹è¿½è¸ª

1. æ‰“å¼€ Jaeger UI: http://localhost:16686
2. é€‰æ‹©æœåŠ¡: `apify`
3. ç‚¹å‡» "Find Traces"
4. æŸ¥çœ‹è¯·æ±‚æµç¨‹ã€æ—¶é—´å’Œé”™è¯¯

### 6. æŸ¥çœ‹æŒ‡æ ‡

#### Prometheus åŸå§‹æŒ‡æ ‡

```bash
curl http://localhost:9090/metrics
```

#### Grafana ä»ªè¡¨æ¿

1. æ‰“å¼€ Grafana: http://localhost:3002
2. ç™»å½•: admin/admin
3. æŸ¥çœ‹é¢„é…ç½®çš„ "Apify Metrics" ä»ªè¡¨æ¿

ä»ªè¡¨æ¿åŒ…å«:
- HTTP è¯·æ±‚é€Ÿç‡
- è¯·æ±‚å»¶è¿Ÿ (p95, p99)
- æ´»è·ƒè¿æ¥æ•°
- å·¥ä½œçº¿ç¨‹æ•°
- æ•°æ®åº“æŸ¥è¯¢é€Ÿç‡

### 7. æŒ‡æ ‡æŸ¥è¯¢ç¤ºä¾‹

åœ¨ Prometheus UI (http://localhost:9092) ä¸­æŸ¥è¯¢:

**è¯·æ±‚é€Ÿç‡**:
```promql
rate(apify_http_requests_total[1m])
```

**95th ç™¾åˆ†ä½å»¶è¿Ÿ**:
```promql
histogram_quantile(0.95, rate(apify_http_request_duration_seconds_bucket[5m]))
```

**é”™è¯¯ç‡**:
```promql
rate(apify_http_requests_total{status=~"5.."}[1m])
```

### 8. ç¯å¢ƒå˜é‡

è¦†ç›–é…ç½®:

```bash
# æ—¥å¿—çº§åˆ«
RUST_LOG=debug

# å·¥ä½œçº¿ç¨‹æ•°
APIFY_THREADS=4

# OpenTelemetry ç«¯ç‚¹
OTEL_EXPORTER_OTLP_ENDPOINT=http://collector:4317
```

## æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Apify      â”‚
â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚  Logging â”‚â”€â”¼â”€â”€â”€â”€â–¶â”‚   stdout    â”‚â”€â”€â”
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Tracing  â”‚â”€â”¼â”€â”€â”€â”€â–¶â”‚ OTLP (gRPC) â”‚â”€â”€â”¼â”€â”€â”€â–¶â”‚    Jaeger    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚              â”‚                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚ Metrics  â”‚â”€â”¼â”€â”€â”€â”€â–¶â”‚  HTTP:9090  â”‚â”€â”€â”¼â”€â”€â”€â–¶â”‚  Prometheus  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                                       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â””â”€â”€â”€â–¶â”‚   Grafana    â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åŠŸèƒ½ç‰¹æ€§

### ğŸ“ ç»“æ„åŒ–æ—¥å¿—
- JSON æ ¼å¼ï¼Œä¾¿äºæœºå™¨è§£æ
- æ”¯æŒæ—¥å¿—çº§åˆ«è¿‡æ»¤
- åŒ…å«çº¿ç¨‹IDã€è¯·æ±‚IDã€span ID
- æºä»£ç ä½ç½® (æ–‡ä»¶å’Œè¡Œå·)

### ğŸ” åˆ†å¸ƒå¼è¿½è¸ª
- OTLP å¯¼å‡ºå™¨ï¼Œæ”¯æŒ Jaeger/Tempo ç­‰
- è‡ªåŠ¨è¿½è¸ª HTTP è¯·æ±‚å’Œæ•°æ®åº“æŸ¥è¯¢
- è·¨æœåŠ¡è¿½è¸ªIDä¼ æ’­
- Span å±æ€§åŒ…å« method, path, status, duration

### ğŸ“Š Prometheus æŒ‡æ ‡
- HTTP æŒ‡æ ‡: è¯·æ±‚æ•°ã€å»¶è¿Ÿã€æ´»è·ƒè¿æ¥
- æ•°æ®åº“æŒ‡æ ‡: æŸ¥è¯¢æ•°ã€å»¶è¿Ÿ
- ç³»ç»ŸæŒ‡æ ‡: å·¥ä½œçº¿ç¨‹æ•°

## æ€§èƒ½å½±å“

å…¸å‹åœºæ™¯ä¸‹çš„å¼€é”€:

- **æ—¥å¿—**: < 1% CPU, å†…å­˜å ç”¨å¾ˆå°
- **è¿½è¸ª**: 2-5% CPU, æ¯1000ä¸ª span ~10MB å†…å­˜
- **æŒ‡æ ‡**: < 1% CPU, æ¯1000ä¸ªåºåˆ— ~1MB å†…å­˜

**æ€»å¼€é”€**: çº¦ 5-10%

## ä¸‹ä¸€æ­¥

- æŸ¥çœ‹å®Œæ•´æ–‡æ¡£: [observability/README.md](README.md)
- è‡ªå®šä¹‰ Grafana ä»ªè¡¨æ¿
- é…ç½®å‘Šè­¦è§„åˆ™
- é›†æˆåˆ°ç”Ÿäº§ç¯å¢ƒ

## æ•…éšœæ’é™¤

### çœ‹ä¸åˆ°è¿½è¸ªæ•°æ®

```bash
# æ£€æŸ¥ Jaeger æ˜¯å¦å¯è®¿é—®
curl http://localhost:4317

# æŸ¥çœ‹æ—¥å¿—ä¸­çš„ OpenTelemetry é”™è¯¯
docker compose logs apify-sqlite | grep -i otel
```

### æŒ‡æ ‡ä¸æ˜¾ç¤º

```bash
# æ£€æŸ¥æŒ‡æ ‡ç«¯ç‚¹
curl http://localhost:9090/metrics

# æ£€æŸ¥ Prometheus ç›®æ ‡çŠ¶æ€
open http://localhost:9092/targets
```

è¯¦ç»†æ–‡æ¡£è¯·å‚é˜…: [observability/README.md](README.md)
