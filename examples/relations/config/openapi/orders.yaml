openapi:
  spec:
    openapi: 3.0.0
    info:
      title: Order Management API with Relations
      version: 1.0.0
      description: Demonstrates nested object support (hasMany relations)

    components:
      schemas:
        Order:
          x-table-name: orders
          type: object
          required:
            - customer_name
          properties:
            id:
              type: integer
              readOnly: true
            customer_name:
              type: string
              description: Customer name
            total:
              type: number
              description: Order total amount
            status:
              type: string
              enum: [pending, confirmed, shipped, delivered, cancelled]
              default: pending
            items:
              type: array
              description: Order items (nested)
              x-relation:
                type: hasMany
                target: OrderItem
                foreignKey: order_id
              items:
                $ref: '#/components/schemas/OrderItem'
            createdBy:
              type: string
              readOnly: true
            updatedBy:
              type: string
              readOnly: true
            createdAt:
              type: string
              format: date-time
              readOnly: true
            updatedAt:
              type: string
              format: date-time
              readOnly: true

        OrderItem:
          x-table-name: order_items
          type: object
          required:
            - product_name
            - quantity
            - price
          properties:
            id:
              type: integer
              readOnly: true
            order_id:
              type: integer
              description: Foreign key to orders table
            product_name:
              type: string
            quantity:
              type: integer
              minimum: 1
            price:
              type: number
              minimum: 0
            subtotal:
              type: number
              readOnly: true
            createdBy:
              type: string
              readOnly: true
            updatedBy:
              type: string
              readOnly: true
            createdAt:
              type: string
              format: date-time
              readOnly: true
            updatedAt:
              type: string
              format: date-time
              readOnly: true

    paths:
      /orders:
        get:
          x-table-name: orders
          summary: List all orders
          operationId: listOrders
          responses:
            '200':
              description: List of orders
              content:
                application/json:
                  schema:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'

        post:
          x-table-name: orders
          summary: Create a new order with items
          operationId: createOrder
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Order'
                examples:
                  orderWithItems:
                    summary: Order with nested items
                    value:
                      customer_name: "Alice Johnson"
                      total: 150.00
                      items:
                        - product_name: "Laptop"
                          quantity: 1
                          price: 100.00
                        - product_name: "Mouse"
                          quantity: 2
                          price: 25.00
          responses:
            '200':
              description: Order created
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/Order'

      /orders/{id}:
        get:
          x-table-name: orders
          summary: Get order by ID
          operationId: getOrder
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          responses:
            '200':
              description: Order details
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/Order'

        put:
          x-table-name: orders
          summary: Update an order
          operationId: updateOrder
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/Order'
          responses:
            '200':
              description: Order updated
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/Order'

        delete:
          x-table-name: orders
          summary: Delete an order
          operationId: deleteOrder
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          responses:
            '204':
              description: Order deleted

      /order_items:
        get:
          x-table-name: order_items
          summary: List all order items
          operationId: listOrderItems
          responses:
            '200':
              description: List of order items
              content:
                application/json:
                  schema:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderItem'

    x-table-schemas:
      - tableName: "orders"
        columns:
          - name: "id"
            columnType: "INTEGER"
            primaryKey: true
            autoIncrement: true
            nullable: false
            unique: false
          - name: "customer_name"
            columnType: "TEXT"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "total"
            columnType: "REAL"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "status"
            columnType: "TEXT"
            nullable: true
            defaultValue: "'pending'"
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "createdBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "createdAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
        indexes: []
        relations:
          - field_name: "items"
            relation_type: "hasMany"
            target_table: "order_items"
            foreign_key: "order_id"
      - tableName: "order_items"
        columns:
          - name: "id"
            columnType: "INTEGER"
            primaryKey: true
            autoIncrement: true
            nullable: false
            unique: false
          - name: "order_id"
            columnType: "INTEGER"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "product_name"
            columnType: "TEXT"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "quantity"
            columnType: "INTEGER"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "price"
            columnType: "REAL"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "subtotal"
            columnType: "REAL"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "createdBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "createdAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
        indexes: []
