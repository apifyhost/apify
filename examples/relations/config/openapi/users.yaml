openapi:
  spec:
    openapi: 3.0.0
    info:
      title: User Management API with Relations
      version: 1.0.0
      description: Demonstrates hasOne and belongsTo relations

    components:
      schemas:
        User:
          x-table-name: users
          type: object
          required:
            - username
            - email
          properties:
            id:
              type: integer
              readOnly: true
            username:
              type: string
            email:
              type: string
              format: email
            profile:
              type: object
              description: User profile (hasOne)
              x-relation:
                type: hasOne
                target: UserProfile
                foreignKey: user_id
              allOf:
                - $ref: '#/components/schemas/UserProfile'
            createdAt:
              type: string
              format: date-time
              readOnly: true
            updatedAt:
              type: string
              format: date-time
              readOnly: true

        UserProfile:
          x-table-name: user_profiles
          type: object
          properties:
            id:
              type: integer
              readOnly: true
            user_id:
              type: integer
              description: Foreign key to users table
            full_name:
              type: string
            bio:
              type: string
            avatar_url:
              type: string
            user:
              type: object
              description: Parent user (belongsTo)
              x-relation:
                type: belongsTo
                target: User
                foreignKey: user_id
              allOf:
                - $ref: '#/components/schemas/User'
            createdAt:
              type: string
              format: date-time
              readOnly: true
            updatedAt:
              type: string
              format: date-time
              readOnly: true

    paths:
      /users:
        get:
          x-table-name: users
          summary: List all users
          responses:
            '200':
              description: List of users
              content:
                application/json:
                  schema:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'

        post:
          x-table-name: users
          summary: Create a new user with profile
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/User'
                examples:
                  userWithProfile:
                    summary: User with profile
                    value:
                      username: "alice"
                      email: "alice@example.com"
                      profile:
                        full_name: "Alice Johnson"
                        bio: "Software engineer"
                        avatar_url: "https://example.com/avatar.jpg"
          responses:
            '200':
              description: User created
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/User'

      /users/{id}:
        get:
          x-table-name: users
          summary: Get user by ID
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          responses:
            '200':
              description: User details
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/User'

        put:
          x-table-name: users
          summary: Update a user
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/User'
          responses:
            '200':
              description: User updated
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/User'

        delete:
          x-table-name: users
          summary: Delete a user
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          responses:
            '204':
              description: User deleted

      /user_profiles:
        get:
          x-table-name: user_profiles
          summary: List all user profiles
          responses:
            '200':
              description: List of profiles
              content:
                application/json:
                  schema:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserProfile'

      /user_profiles/{id}:
        get:
          x-table-name: user_profiles
          summary: Get profile by ID
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          responses:
            '200':
              description: Profile details
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/UserProfile'

    x-table-schemas:
      - tableName: "users"
        columns:
          - name: "id"
            columnType: "INTEGER"
            primaryKey: true
            autoIncrement: true
            nullable: false
            unique: false
          - name: "username"
            columnType: "TEXT"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "email"
            columnType: "TEXT"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "createdBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "createdAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
        indexes: []
        relations:
          - field_name: "profile"
            relation_type: "hasOne"
            target_table: "user_profiles"
            foreign_key: "user_id"
      - tableName: "user_profiles"
        columns:
          - name: "id"
            columnType: "INTEGER"
            primaryKey: true
            autoIncrement: true
            nullable: false
            unique: false
          - name: "user_id"
            columnType: "INTEGER"
            nullable: false
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "full_name"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "bio"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "avatar_url"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
          - name: "createdBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedBy"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "createdAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
          - name: "updatedAt"
            columnType: "DATETIME"
            nullable: true
            primaryKey: false
            autoIncrement: false
            unique: false
            auto_field: true
        indexes: []
        relations:
          - field_name: "user"
            relation_type: "belongsTo"
            target_table: "users"
            foreign_key: "user_id"
