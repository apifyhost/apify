openapi:
  spec:
    openapi: "3.0.0"
    info:
      title: "E2E Test API"
      version: "1.0.0"
      description: "API for end-to-end testing"

    components:
      securitySchemes:
        ApiKeyAuth:
          type: apiKey
          in: header
          name: X-API-KEY
        BearerAuth:
          type: http
          scheme: bearer
          bearerFormat: JWT
        OpenID:
          type: openIdConnect
          openIdConnectUrl: "${KEYCLOAK_URL:http://localhost:8080}/realms/${KEYCLOAK_REALM:apify}/.well-known/openid-configuration"

    x-table-schemas:
      - tableName: "items"
        columns:
          - name: "id"
            columnType: "INTEGER"
            nullable: false
            primaryKey: true
            unique: false
            autoIncrement: true
          - name: "name"
            columnType: "TEXT"
            nullable: false
            primaryKey: false
            unique: false
            autoIncrement: false
          - name: "description"
            columnType: "TEXT"
            nullable: true
            primaryKey: false
            unique: false
            autoIncrement: false
          - name: "price"
            columnType: "REAL"
            nullable: true
            primaryKey: false
            unique: false
            autoIncrement: false
          - name: "created_at"
            columnType: "TIMESTAMP"
            nullable: false
            primaryKey: false
            unique: false
            autoIncrement: false
            defaultValue: "CURRENT_TIMESTAMP"
        indexes: []

    paths:
      /items:
        get:
          operationId: listItems
          summary: "List all items"
          x-table-name: "items"
          security:
            - ApiKeyAuth: []
          responses:
            "200":
              description: "List of items"

        post:
          operationId: createItem
          summary: "Create a new item"
          x-table-name: "items"
          security:
            - ApiKeyAuth: []
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  type: object
                  required: ["name"]
                  properties:
                    name:
                      type: string
                    description:
                      type: string
                    price:
                      type: number
          responses:
            "200":
              description: "Item created"

      /items/{id}:
        get:
          operationId: getItem
          summary: "Get item by ID"
          x-table-name: "items"
          security:
            - ApiKeyAuth: []
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          responses:
            "200":
              description: "Item details"
            "404":
              description: "Item not found"

        put:
          operationId: updateItem
          summary: "Update an item"
          x-table-name: "items"
          security:
            - ApiKeyAuth: []
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  type: object
          responses:
            "200":
              description: "Item updated"
            "404":
              description: "Item not found"

        delete:
          operationId: deleteItem
          summary: "Delete an item"
          x-table-name: "items"
          security:
            - ApiKeyAuth: []
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: integer
          responses:
            "200":
              description: "Item deleted"
            "404":
              description: "Item not found"

      /healthz:
        get:
          operationId: healthCheck
          summary: "Health check endpoint"
          responses:
            "200":
              description: "Service is healthy"
              content:
                application/json:
                  schema:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "ok"
