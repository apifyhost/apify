# OpenAPI specification for CRUD operations
openapi:
  spec:
    openapi: "3.0.0"
    info:
      title: "Apify Books CRUD API"
      version: "1.0.0"
      description: "Auto-generated CRUD API for books management"
    
    # Table schema definition - used for dynamic table creation
    x-table-schemas:
      - table_name: "books"
        columns:
          - name: "id"
            column_type: "INTEGER"
            nullable: false
            primary_key: true
            unique: false
            auto_increment: true
            default_value: null
          - name: "title"
            column_type: "TEXT"
            nullable: false
            primary_key: false
            unique: false
            auto_increment: false
            default_value: null
          - name: "author"
            column_type: "TEXT"
            nullable: false
            primary_key: false
            unique: false
            auto_increment: false
            default_value: null
          - name: "isbn"
            column_type: "TEXT"
            nullable: true
            primary_key: false
            unique: true
            auto_increment: false
            default_value: null
          - name: "published_date"
            column_type: "DATE"
            nullable: true
            primary_key: false
            unique: false
            auto_increment: false
            default_value: null
          - name: "price"
            column_type: "REAL"
            nullable: true
            primary_key: false
            unique: false
            auto_increment: false
            default_value: null
          - name: "created_at"
            column_type: "DATETIME"
            nullable: false
            primary_key: false
            unique: false
            auto_increment: false
            default_value: "CURRENT_TIMESTAMP"
        indexes:
          - name: "idx_books_author"
            columns: ["author"]
            unique: false
          - name: "idx_books_isbn"
            columns: ["isbn"]
            unique: false
          - name: "idx_books_published_date"
            columns: ["published_date"]
            unique: false
    
    paths:
      /books:
        get:
          summary: "List all books"
          operationId: "listBooks"
          responses:
            "200":
              description: "List of books"
              content:
                application/json:
                  schema:
                    type: array
                    items:
                      $ref: "#/components/schemas/Book"
        post:
          summary: "Create a new book"
          operationId: "createBook"
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/NewBook"
          responses:
            "201":
              description: "Book created"
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Book"
      /books/{id}:
        get:
          summary: "Get book by ID"
          operationId: "getBook"
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: string
          responses:
            "200":
              description: "Book found"
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Book"
            "404":
              description: "Book not found"
        put:
          summary: "Update book"
          operationId: "updateBook"
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: string
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/BookUpdate"
          responses:
            "200":
              description: "Book updated"
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/Book"
        delete:
          summary: "Delete book"
          operationId: "deleteBook"
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: string
          responses:
            "200":
              description: "Book deleted"
              content:
                application/json:
                  schema:
                    type: object
                    properties:
                      message:
                        type: string
                      affected_rows:
                        type: integer
    components:
      schemas:
        Book:
          type: object
          properties:
            id:
              type: string
            title:
              type: string
            author:
              type: string
            isbn:
              type: string
            published_date:
              type: string
              format: date
            price:
              type: number
              format: float
            created_at:
              type: string
              format: date-time
        NewBook:
          type: object
          required:
            - title
            - author
          properties:
            title:
              type: string
              minLength: 1
            author:
              type: string
              minLength: 1
            isbn:
              type: string
            published_date:
              type: string
              format: date
            price:
              type: number
              format: float
              minimum: 0
        BookUpdate:
          type: object
          properties:
            title:
              type: string
              minLength: 1
            author:
              type: string
              minLength: 1
            isbn:
              type: string
            published_date:
              type: string
              format: date
            price:
              type: number
              format: float
              minimum: 0
  validation:
    strict_mode: true
    validate_request_body: true
    validate_response_body: false
datasource: sqlite1  # Use sqlite1 datasource for books
