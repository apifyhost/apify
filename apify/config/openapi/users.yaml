# OpenAPI specification for CRUD operations
openapi:
  spec:
    openapi: "3.0.0"
    info:
      title: "Apify CRUD API"
      version: "1.0.0"
      description: "Auto-generated CRUD API"
    
    # Table schema definition - used for dynamic table creation
    x-table-schemas:
      - table_name: "users"
        columns:
          - name: "id"
            column_type: "INTEGER"
            nullable: false
            primary_key: true
            unique: false
            auto_increment: true
            default_value: null
          - name: "name"
            column_type: "TEXT"
            nullable: false
            primary_key: false
            unique: false
            auto_increment: false
            default_value: null
          - name: "email"
            column_type: "TEXT"
            nullable: false
            primary_key: false
            unique: true
            auto_increment: false
            default_value: null
          - name: "created_at"
            column_type: "DATETIME"
            nullable: false
            primary_key: false
            unique: false
            auto_increment: false
            default_value: "CURRENT_TIMESTAMP"
        indexes:
          - name: "idx_users_email"
            columns: ["email"]
            unique: false
          - name: "idx_users_created_at"
            columns: ["created_at"]
            unique: false
    
    paths:
      /users:
        get:
          summary: "List all users"
          operationId: "listUsers"
          x-modules:
            access: ["auth_header"]
          responses:
            "200":
              description: "List of users"
              content:
                application/json:
                  schema:
                    type: array
                    items:
                      $ref: "#/components/schemas/User"
        post:
          summary: "Create a new user"
          operationId: "createUser"
          x-modules:
            access: ["auth_header"]
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/NewUser"
          responses:
            "201":
              description: "User created"
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/User"
      /users/{id}:
        get:
          summary: "Get user by ID"
          operationId: "getUser"
          x-modules:
            access: ["auth_header"]
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: string
          responses:
            "200":
              description: "User found"
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/User"
            "404":
              description: "User not found"
        put:
          summary: "Update user"
          operationId: "updateUser"
          x-modules:
            access: ["auth_header"]
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: string
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: "#/components/schemas/UserUpdate"
          responses:
            "200":
              description: "User updated"
              content:
                application/json:
                  schema:
                    $ref: "#/components/schemas/User"
        delete:
          summary: "Delete user"
          operationId: "deleteUser"
          x-modules:
            access: ["auth_header"]
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: string
          responses:
            "200":
              description: "User deleted"
              content:
                application/json:
                  schema:
                    type: object
                    properties:
                      message:
                        type: string
                      affected_rows:
                        type: integer
    components:
      schemas:
        User:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            email:
              type: string
            created_at:
              type: string
              format: date-time
        NewUser:
          type: object
          required:
            - name
            - email
          properties:
            name:
              type: string
              minLength: 1
            email:
              type: string
              format: email
        UserUpdate:
          type: object
          properties:
            name:
              type: string
              minLength: 1
            email:
              type: string
              format: email
  validation:
    strict_mode: true
    validate_request_body: true
    validate_response_body: false
